services:
  soporte:
    image: httpd:latest
    container_name: soporte_container
    volumes:
      - ./soporte/index.html:/usr/local/apache2/htdocs/index.html
    environment:
      VIRTUAL_HOST: soporte.docker.local
    restart: always

  test:
    image: httpd:latest
    container_name: test_container
    volumes:
      - ./test/index.html:/usr/local/apache2/htdocs/index.html
    environment:
      VIRTUAL_HOST: test.docker.local
    restart: always

  ldap:
    image: osixia/openldap:1.5.0
    container_name: ldap_container
    environment:
      LDAP_DOMAIN: "as.cat"
      LDAP_ORGANISATION: "institut"
      LDAP_ADMIN_PASSWORD: "1234"
    volumes:
      - ./ldap/config:/etc/ldap/slapd.d
      - ./ldap/data:/var/lib/ldap
      - /var/lib/ldap
      - /etc/ldap/slapd.d
      - /container/service/slapd/assets/certs/
    restart: always
    
  ldap_account_manager:
    image: ldapaccountmanager/lam:stable
    container_name: ldap_account_manager_container
    environment:
      VIRTUAL_HOST: ldap.docker.local
    depends_on:
      - ldap
    restart: always
    
  nginx-proxy:
    image: jwilder/nginx-proxy
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
    restart: always
    privileged: true
